(this["webpackJsonpfs-shop"]=this["webpackJsonpfs-shop"]||[]).push([[0],{250:function(e,t,a){e.exports=a(412)},255:function(e,t,a){},412:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(40),s=a.n(o),l=(a(255),a(237)),i=a(18),c=a(19),u=a(21),p=a(20),m=(a(83),a(26)),d=a(425),g=a(424),h=a(35),E=function(){return{type:"LOADING"}},f=function(){return{type:"REGISTER_SUCCESS"}},b=function(e){return{type:"REGISTER_FAILED",error:e}},k=function(e){return{type:"LOGIN_SUCCESS",token:e.token,nickname:e.nickname}},v=function(e){return{type:"LOGIN_FAILED",error:e}},y=function(){return{type:"LOGOUT_SUCCESS"}},C=function(e){return{type:"LOGOUT_FAILED"}},O=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).logout=function(){var e;n.props.dispatch((e=n.props.token,console.log("logout.js logout state:"+JSON.stringify(e)),function(t){fetch("/shop/user/logout",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",token:e}}).then((function(e){console.log("Logout kutsuttu"),e.ok?t(y()):t(C("Server responded with an error. Logging out"))})).catch((function(e){return t(C("Server responded with an error. Error:"+e)),!1})).finally((function(){return console.log("Finally"),!0}))}))},n.setCategory=function(e){console.log("item ",e),null!==e?(n.setState({currentCategory:e}),n.props.category(e)):n.setState({currentCategory:[]})},n.setSubCategory=function(e){n.props.category(e)},n.state={currentCategory:n.props.categories},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t="FS - Shop";return this.props.loading&&(t="Loading..."),this.props.error&&(t="Error:"+this.props.error),r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"fs-navbar-header"},r.a.createElement(d.a,{className:"fs-navbar-header"},t)),r.a.createElement("div",{className:"fs-navbar-buttons"},this.props.isLogged?r.a.createElement("div",{className:"fs-useraction-section"},r.a.createElement("span",null,"Hello ",this.props.nickname,","),r.a.createElement("div",{className:"logoutButton"},r.a.createElement(g.a,{onClick:function(){return e.logout()}},"Log out"))):r.a.createElement("div",{className:"fs-useraction-section"},r.a.createElement(g.a,{style:{position:"float:left"},onClick:function(){return e.setCategory(null)}},r.a.createElement(m.b,{to:"/login"},"Login"))),r.a.createElement("div",null,"Choose category below:",r.a.createElement("div",null,r.a.createElement(m.b,{to:"/list"},this.props.categories.map((function(t,a){return r.a.createElement(g.a,{key:a,onClick:function(){return e.setCategory(t.products)}},t.categoryName)})))))))}}]),a}(r.a.Component),S=Object(h.b)((function(e){return{error:e.login.error,loading:e.login.loading,isLogged:e.login.isLogged,token:e.login.token,nickname:e.login.nickname}}))(O),I=a(420),j=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).onChange=function(e){var t={};t[e.target.name]=e.target.value,n.setState(t)},n.onLogin=function(){if(n.state.username.length<4||n.state.password.length<8)alert("Username must be four characters and password eight characters long");else{var e={email:n.state.username,password:n.state.password};n.props.dispatch(function(e){return function(t){var a={method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};t(E()),fetch("/shop/user/login",a).then((function(e){e.ok?e.json().then((function(e){console.log("login response OK"),t(k(e))})).catch((function(e){t(v("Failed to parse response. Reason:"+e))})):t(v("Login failed. Please provide proper credentials."))})).catch((function(e){t(v(e))}))}}(e))}},n.state={username:"",password:""},n}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement(I.a,null,r.a.createElement(I.a.Field,null,r.a.createElement("label",{htmlFor:"username"},"Username"),r.a.createElement("input",{type:"text",name:"username",value:this.state.username,onChange:this.onChange})),r.a.createElement(I.a.Field,null,r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",name:"password",value:this.state.password,onChange:this.onChange})),r.a.createElement(m.b,{to:"/register"},r.a.createElement(g.a,null,"Register")),r.a.createElement(g.a,{onClick:this.onLogin},"Login"))}}]),a}(r.a.Component),w=Object(h.b)()(j),L=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).onChange=function(e){var t={};t[e.target.name]=e.target.value,n.setState(t)},n.onSubmit=function(e){if(e.preventDefault(),0!==n.state.nickname.length&&0!==n.state.email.length){var t={nickname:n.state.nickname,email:n.state.email,password:n.state.password,passwordverification:n.state.passwordverification};n.props.dispatch(function(e){return function(t){var a={method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};t(E()),fetch("/shop/user/register",a).then((function(e){e.ok?(alert("Register success"),t(f())):(alert("Register failed. Is username already in use?"),t(b("Register failed. Is username already in use?")))})).catch((function(e){t(b(e))}))}}(t)),n.setState({nickname:"",email:[],password:"",passwordverification:""})}else alert("All fields required")},n.submit=function(e){e.preventDefault()},n.state={nickname:"",email:[],password:"",passwordverification:""},n}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(I.a,{onSubmit:this.submit},r.a.createElement(d.a,{as:"h2"},"Register account"),r.a.createElement(I.a.Field,null,r.a.createElement("label",{htmlFor:"nickname"},"Nickname"),r.a.createElement("input",{type:"text",name:"nickname",onChange:this.onChange,value:this.state.nickname})),r.a.createElement(I.a.Field,null,r.a.createElement("label",{htmlFor:"nickname"},"Email"),r.a.createElement("input",{type:"text",name:"email",onChange:this.onChange,value:this.state.email})),r.a.createElement(I.a.Field,null,r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",name:"password",value:this.state.password,onChange:this.onChange})),r.a.createElement(I.a.Field,null,r.a.createElement("label",{htmlFor:"password"},"Password verification"),r.a.createElement("input",{type:"passwordverification",name:"passwordverification",value:this.state.passwordverification,onChange:this.onChange}))),r.a.createElement(g.a,{onClick:this.onSubmit},"Save"),r.a.createElement(m.b,{to:"/"},r.a.createElement(g.a,null,"Home")))}}]),a}(r.a.Component),F=Object(h.b)()(L),T=a(423),N=a(238),q=a(421),R=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement(q.a,{trigger:r.a.createElement(g.a,null,this.props.product.name," details"),centered:!1},r.a.createElement(q.a.Header,null,this.props.product.label),r.a.createElement(q.a.Content,{image:!0},r.a.createElement(N.a,{style:{maxWidth:"200px",maxHeight:"200px"},src:this.props.product.image}),r.a.createElement(q.a.Description,null,r.a.createElement(d.a,null," ",this.props.product.name),r.a.createElement("p",null,this.props.product.description),r.a.createElement("p",null,"Price: ",this.props.product.price,"\xa0",this.props.product.priceTypeText))))}}]),a}(r.a.Component),D=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).basket=function(e,t){n.props.basket(e,t)},n.onChange=function(e){var t={};t[e.target.name]=e.target.value,n.setState(t)},n.state={modalOpen:!1},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=this.props.list.map((function(t,a){return r.a.createElement(T.a.Row,{key:a},r.a.createElement(T.a.Cell,null,r.a.createElement(N.a,{src:t.image})),r.a.createElement(T.a.Cell,null,r.a.createElement(R,{product:t})),r.a.createElement(T.a.Cell,null,t.quantity),r.a.createElement(T.a.Cell,null,t.price,"\xa0",t.priceTypeText),r.a.createElement(T.a.Cell,null,t.quantity<=0||"Basket"===e.props.label?"":r.a.createElement("input",{type:"number",name:t.productId,onChange:e.onChange,defaultValue:"1",min:"1",max:t.quantity,value:e.state[t.productId]>t.quantity?t.quantity:e.state[t.productId]}),r.a.createElement(g.a,{onClick:function(){return e.basket(t,e.state[t.productId]<=t.quantity?e.state[t.productId]:e.state[t.productId]?t.quantity:1)},disabled:t.quantity<=0},e.props.text," basket")))}));return r.a.createElement(T.a,{celled:!0,className:"fs-products-table"},r.a.createElement(T.a.Header,null,r.a.createElement(T.a.Row,null,r.a.createElement(T.a.HeaderCell,null),r.a.createElement(T.a.HeaderCell,null),r.a.createElement(T.a.HeaderCell,null,"Quantity"),r.a.createElement(T.a.HeaderCell,null,"Price"))),r.a.createElement(T.a.Body,null,t))}}]),a}(r.a.Component),B=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).basket=function(e,t){n.props.basket(e,t),0===n.props.list.length&&n.props.show()},n.onChange=function(e){var t={};t[e.target.name]=e.target.value,n.setState(t)},n.state={modalOpen:!1},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=this.props.list.map((function(t,a){return r.a.createElement(T.a.Row,{key:a},r.a.createElement(T.a.Cell,null,r.a.createElement(N.a,{src:t.image,width:500,height:300,mode:"fit"})),r.a.createElement(R,{product:t}),r.a.createElement(T.a.Cell,null,t.quantity),r.a.createElement(T.a.Cell,null,t.price),r.a.createElement(T.a.Cell,null,t.quantity<=0||"Basket"===e.props.label?"":r.a.createElement("input",{type:"number",name:t.productId,onChange:e.onChange,min:"1",max:t.quantity,value:e.state[t.productId]>t.quantity?t.quantity:e.state[t.productId]}),r.a.createElement(g.a,{onClick:function(){return e.basket(t,e.state[t.productId]<=t.quantity?e.state[t.productId]:e.state[t.productId]?t.quantity:1)},disabled:t.quantity<=0},e.props.text," basket")))}));return r.a.createElement(T.a,{celled:!0},r.a.createElement(T.a.Header,null,r.a.createElement(T.a.Row,null,r.a.createElement(T.a.HeaderCell,null),r.a.createElement(T.a.HeaderCell,null),r.a.createElement(T.a.HeaderCell,null,"Quantity"),r.a.createElement(T.a.HeaderCell,null,"Price"))),r.a.createElement(T.a.Body,null,t))}}]),a}(r.a.Component),_=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).basketCost=function(){for(var e=0,t=0;t<n.props.list.length;t++)e+=n.props.list[t].quantity*n.props.list[t].price;return e.toFixed(2)},n.showBasket=function(){n.setState({showBasketList:!n.state.showBasketList})},n.state={showBasketList:!1},n}return Object(c.a)(a,[{key:"basketSize",value:function(){for(var e=0,t=0;t<this.props.list.length;t++)e+=parseInt(this.props.list[t].quantity);return e}},{key:"render",value:function(){var e=this;return this.props.list.length>0?r.a.createElement("div",{style:{position:"absolute",right:"100px",top:"15px"}},r.a.createElement("button",{onClick:this.showBasket},"Amount:",this.basketSize(),r.a.createElement("hr",null),"Price total:",this.basketCost()),this.state.showBasketList?r.a.createElement(B,{list:this.props.list,basket:this.props.basket,text:"Remove from",label:"Basket",show:this.showBasket}):r.a.createElement("div",null),this.props.isLogged?r.a.createElement(g.a,{onClick:function(){return e.setState({showBasketList:!1})}},r.a.createElement(m.b,{to:"/purchase"},"Cash out")):r.a.createElement(g.a,{onClick:function(){return e.setState({showBasketList:!1})}},r.a.createElement(m.b,{to:"/login"},"Login"))):r.a.createElement("div",null)}}]),a}(r.a.Component),P=a(239),x=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).basket=function(e,t){n.props.basket(e,t)},n.onChange=function(e){var t={};t[e.target.name]=e.target.value,n.setState(t)},n.onSubmit=function(e){e.preventDefault();var t=n.props.list.map((function(e){e.name,e.id,e.image,e.price,e.description;return Object(P.a)(e,["name","id","image","price","description"])}));n.props.onPurchase(t)},n.state={modalOpen:!1},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=this.props.list.map((function(t,a){return r.a.createElement(T.a.Row,{key:a},r.a.createElement(T.a.Cell,null,t.name),r.a.createElement(T.a.Cell,null,t.quantity),r.a.createElement(T.a.Cell,null,t.price),r.a.createElement(T.a.Cell,null,r.a.createElement(g.a,{onClick:function(){return e.basket(t,e.state[t.productId]<=t.quantity?e.state[t.productId]:e.state[t.productId]?t.quantity:1)},disabled:t.quantity<=0},e.props.text," basket")))}));return r.a.createElement("div",null,r.a.createElement(T.a,{celled:!0},r.a.createElement(T.a.Header,null,r.a.createElement(T.a.Row,null,r.a.createElement(T.a.HeaderCell,null),r.a.createElement(T.a.HeaderCell,null,"Quantity"),r.a.createElement(T.a.HeaderCell,null,"Price"))),r.a.createElement(T.a.Body,null,t)),r.a.createElement(g.a,{onClick:this.onSubmit},"Confirm purchase"),r.a.createElement(m.b,{to:"/"},r.a.createElement(g.a,null,"Cancel")))}}]),a}(r.a.Component),H=a(52),A=function(e){return{type:"FETCH_PRODUCTS_SUCCESS",categories:e}},G=function(e){return{type:"FETCH_PRODUCTS_FAILED",error:e}},U=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).updateQuantity=function(e,t){for(var a=n.state.category,r=0;r<a.length;r++)if(e===a[r].productId)return console.log("quantity",t),void(a[r].quantity+=parseInt(t))},n.addToBasket=function(e,t){console.log(e+" ADD to basket");for(var a=0,r=[],o=0;o<n.state.basket.length;o++)if(e.productId===n.state.basket[o].productId){console.log(e.productId+" Found in basket"),r=n.state.basket,a=parseInt(r[o].quantity)+parseInt(t),console.log(a);var s={id:r[o]._id,productId:r[o].productId,name:r[o].name,price:r[o].price,quantity:a,image:r[o].image,description:r[o].description};return n.updateQuantity(e.productId,parseInt(-t)),r.splice(o,1,s),void n.setState({basket:r})}var i={id:e._id,productId:e.productId,name:e.name,price:e.price,quantity:t,image:e.image,description:e.description};n.updateQuantity(e.productId,parseInt(-t)),n.setState({basket:[].concat(Object(l.a)(n.state.basket),[i])})},n.emptyBasket=function(){n.setState({basket:[]})},n.removeFromBasket=function(e){console.log(e.productId+" Remove from basket");for(var t=[],a=0;a<n.state.basket.length;a++)if(e.productId===n.state.basket[a].productId)return console.log(e.productId+" Found in basket"),t=n.state.basket,n.updateQuantity(e.productId,t[a].quantity),t.splice(a,1),void n.setState({basket:t})},n.setCategory=function(e){n.setState({category:e})},n.onPurchase=function(e){var t={method:"POST",mode:"cors",headers:{"Content-Type":"application/json",token:n.props.token},body:JSON.stringify(e)};fetch("/shop/api/cashout",t).then((function(e){e.ok?(alert("Purchase success"),n.emptyBasket()):alert("Purchase failed.")})).catch((function(e){console.log(e)}))},n.state={basket:[],basketSize:0,category:[],token:null,nickname:void 0},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.props.dispatch((function(e){e(E()),fetch("/shop/products",{method:"GET",mode:"cors",headers:{"Content-type":"application/json"}}).then((function(t){e({type:"END_LOADING"}),t.ok?(console.log("1",t),t.json().then((function(t){e(A(t)),console.log("2",t)})).catch((function(t){e(G("Failed to parse information. Try again"))}))):(console.log("No data"),e(G("Server responded with status:"+t.statusText)))})).catch((function(t){console.log(t),e({type:"END_LOADING"}),e(G("Server responded with an error:"+t))}))}))}},{key:"render",value:function(){var e=this;return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"App"},r.a.createElement(S,{categories:this.props.categories,category:this.setCategory}),r.a.createElement(H.d,null,r.a.createElement(H.b,{path:"/list",render:function(){return r.a.createElement(D,{list:e.state.category,basket:e.addToBasket,text:"Add to",label:"Products"})}}),r.a.createElement(H.b,{path:"/login",render:function(){return e.props.isLogged?r.a.createElement(H.a,{to:"/"}):r.a.createElement(w,{onLogin:e.onLogin})}}),r.a.createElement(H.b,{path:"/register",render:function(){return e.props.isLogged?r.a.createElement(H.a,{to:"/"}):r.a.createElement(F,{onRegister:e.onRegister})}}),r.a.createElement(H.b,{path:"/purchase",render:function(){return e.props.isLogged?r.a.createElement(x,{onPurchase:e.onPurchase,list:e.state.basket,basket:e.removeFromBasket,text:"Remove from"}):r.a.createElement(H.a,{to:"/"})}})),r.a.createElement(_,{list:this.state.basket,basket:this.removeFromBasket,isLogged:this.props.isLogged})))}}]),a}(r.a.Component),J=Object(H.g)(Object(h.b)((function(e){return{isLogged:e.login.isLogged,token:e.login.token,nickname:e.login.nickname,categories:e.product.categories}}))(U));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Q=a(43),z=function(e){sessionStorage.setItem("loginstate",JSON.stringify(e))},W=sessionStorage.getItem("loginstate")?JSON.parse(sessionStorage.getItem("loginstate")):{token:"",isLogged:!1,loading:!1,nickname:"",error:""},M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0,a={};switch(t.type){case"LOADING":return Object(Q.a)({},e,{loading:!0,error:""});case"END_LOADING":return Object(Q.a)({},e,{loading:!1,error:""});case"REGISTER_SUCCESS":return a=Object(Q.a)({},e,{error:"",loading:!1}),z(a),a;case"REGISTER_FAILED":return a=Object(Q.a)({},e,{loading:!1,error:t.error}),z(a),a;case"LOGIN_SUCCESS":return a={isLogged:!0,token:t.token,nickname:t.nickname,error:"",loading:!1},z(a),a;case"LOGIN_FAILED":return a=Object(Q.a)({},e,{error:t.error,loading:!1}),z(a),a;case"LOGOUT_SUCCESS":return z(a={token:"",isLogged:!1,loading:!1,error:"",nickname:""}),a;case"LOGOUT_FAILED":return a={token:"",isLogged:!1,nickname:"",loading:!1,error:t.error},z(a),a;default:return e}},K=a(71),V=a(236),$=function(e){sessionStorage.setItem("productstate",JSON.stringify(e))},X=sessionStorage.getItem("productstate")?JSON.parse(sessionStorage.getItem("productstate")):{categories:[],error:""},Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X,t=arguments.length>1?arguments[1]:void 0,a={};switch(t.type){case"FETCH_PRODUCTS_SUCCESS":return a=Object(Q.a)({},e,{categories:t.categories,error:""}),$(a),a;case"FETCH_PRODUCTS_FAILED":return a=Object(Q.a)({},e,{error:t.error}),$(a),a;default:return e}},Z=Object(K.c)({login:M,product:Y}),ee=Object(K.d)(Z,Object(K.a)(V.a));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(h.a,{store:ee},r.a.createElement(m.a,null,r.a.createElement(J,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},83:function(e,t,a){}},[[250,1,2]]]);
//# sourceMappingURL=main.9ba19eb2.chunk.js.map